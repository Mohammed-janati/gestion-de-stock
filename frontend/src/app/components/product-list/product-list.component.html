<div class="product-list-container">
  <!-- Header Section -->
  <div class="list-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">Product Management</h1>
        <p class="page-subtitle">Manage your inventory with precision and ease</p>
      </div>
      <button class="add-product-btn" (click)="openAddProduct()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Add Product
      </button>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="search-bar">
      <div class="search-input-wrapper">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
          <path d="21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <input
          type="text"
          placeholder="Search products..."
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
          class="search-input"
        >
      </div>
    </div>

    <div class="filter-controls">
      <select [(ngModel)]="stockFilter" (change)="onStockFilterChange()" class="filter-select">
        <option value="all">All Products</option>
        <option value="low">Low Stock</option>
        <option value="out">Out of Stock</option>
        <option value="active">Active</option>
        <option value="inactive">Inactive</option>
      </select>
    </div>
  </div>

  <!-- Products Grid -->
  <div class="products-grid">
    <div *ngFor="let product of filteredProducts" class="product-card" [class.inactive]="!product.isActive">
      <div class="product-header">
        <div class="product-status" [ngClass]="getStockStatusClass(product.quantity, product.minStockLevel)">
          {{ getStockStatusText(product.quantity, product.minStockLevel) }}
        </div>
        <div class="product-actions">
          <button class="action-btn edit-btn" (click)="openEditProduct(product)" title="Edit Product">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <button class="action-btn delete-btn" (click)="deleteProduct(product)" title="Delete Product">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M10 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M14 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="product-content">
        <h3 class="product-name">{{ product.name }}</h3>
        <p class="product-code">Code: {{ product.productCode }}</p>
        <p class="product-description" *ngIf="product.description">{{ product.description }}</p>

        <div class="product-details">
          <div class="detail-row">
            <span class="detail-label">Price:</span>
            <span class="detail-value price">${{ product.price | number:'1.2-2' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Stock:</span>
            <span class="detail-value stock">{{ product.quantity }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Min Level:</span>
            <span class="detail-value">{{ product.minStockLevel }}</span>
          </div>
        </div>
      </div>

      <div class="product-footer">
        <button class="movement-btn" (click)="openMovementModal(product)">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2"/>
          </svg>
          View Movements
        </button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="filteredProducts.length === 0" class="empty-state">
    <div class="empty-icon">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 7V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M21 7H3L5 19H19L21 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <h3>No Products Found</h3>
    <p>No products match your current filters. Try adjusting your search or filters.</p>
    <button class="add-product-btn" (click)="openAddProduct()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Add Your First Product
    </button>
  </div>
</div>

<!-- Product Form Modal -->
<div class="modal-overlay" *ngIf="showProductForm" (click)="showProductForm = false">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditing ? 'Edit Product' : 'Add New Product' }}</h2>
      <button class="close-btn" (click)="showProductForm = false">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    <form class="product-form" (ngSubmit)="saveProduct()">
      <div class="form-row">
        <div class="form-group">
          <label for="name">Product Name *</label>
          <input type="text" id="name" [(ngModel)]="productForm.name" name="name" required>
        </div>
        <div class="form-group">
          <label for="productCode">Product Code *</label>
          <input type="text" id="productCode" [(ngModel)]="productForm.productCode" name="productCode" required>
        </div>
      </div>

      <div class="form-group">
        <label for="description">Description</label>
        <textarea id="description" [(ngModel)]="productForm.description" name="description" rows="3"></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="price">Price *</label>
          <input type="number" id="price" [(ngModel)]="productForm.price" name="price" step="0.01" min="0" required>
        </div>
        <div class="form-group">
          <label for="quantity">Initial Quantity *</label>
          <input type="number"  [(ngModel)]="productForm.quantity" name="quantity" min="0" required>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="minStockLevel">Minimum Stock Level *</label>
          <input type="number" id="minStockLevel" [(ngModel)]="productForm.minStockLevel" name="minStockLevel" min="0" required>
        </div>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="productForm.isActive" name="isActive">
            <span class="checkmark"></span>
            Active Product
          </label>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="cancel-btn" (click)="showProductForm = false">Cancel</button>
        <button type="submit" class="save-btn">{{ isEditing ? 'Update Product' : 'Create Product' }}</button>
      </div>
    </form>
  </div>
</div>

<!-- Stock Movement Modal -->
<div class="modal-overlay" *ngIf="showMovementModal" (click)="closeMovementModal()">
  <div class="modal-content large-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Stock Movement - {{ selectedProduct?.name }}</h2>
      <button class="close-btn" (click)="closeMovementModal()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    <div class="movement-content">
      <!-- Stock Update Form -->
      <div class="movement-form-section">
        <h3>Update Stock</h3>
        <div class="current-stock">
          <h4>Current Stock: {{ selectedProduct?.quantity }}</h4>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="quantity">Quantity</label>
            <input type="number" id="quantity" [(ngModel)]="stockUpdateForm.quantity" name="quantity" min="1" required>
          </div>
          <div class="form-group">
            <label for="cause">Cause</label>
            <select id="cause" [(ngModel)]="stockUpdateForm.cause" name="cause" required>
              <option value="PURCHASE">Purchase</option>
              <option value="SALE">Sale</option>
              <option value="RETURN">Return</option>
              <option value="ADJUSTMENT">Adjustment</option>
              <option value="DAMAGE">Damage</option>
              <option value="THEFT">Theft</option>
            </select>
          </div>
        </div>

        <div class="movement-actions">
          <button type="button" class="add-stock-btn" (click)="updateStock()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Add Stock
          </button>
          <button type="button" class="remove-stock-btn" (click)="removeStock()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Remove Stock
          </button>
        </div>
      </div>

      <!-- Movement History -->
      <div class="movement-history-section" *ngIf="selectedProduct">
        <h3>Movement History</h3>
        <app-product-movements
          [productId]="selectedProduct.id!"
          [productName]="selectedProduct.name">
        </app-product-movements>
      </div>
    </div>
  </div>
</div>
